/*!
 * Monocle - A simple image zoom plugin for jQuery
 * Author: @felixtriller
 *
 * Version 1.1
 *
 * Copyright (c) 2012 TravelTrex GmbH
 *
 * Licensed under the LGPL License (LICENSE.txt).
 *
 * Thanks to the jQuery team for their awesome JavaScript library.
 * Thanks to Brandon Aaron (http://brandonaaron.net) for his jQuery mousewheel plugin.
 *
 * CHANGELOG
 * Version 1.1 - 2012-10-30
 * - now using the whole window for zooming
 * - improved script behavior on window resize
 *
 * Version 1.0 - 2012-10-04
 * - initial release
 *
 * TODO
 * - zoom relative to mouse position
 * - disable controls when not usable
 * - simplify formulas
 */
(function(d,c,b,e){var a=function(g,f){this.elem=d(g);this.options=f};a.prototype={defaults:{maxZoom:5,responsive:true,animationSpeed:300,keyboard:true},init:function(){var g=this;this.config=d.extend({},this.defaults,this.options);this.zoomlevel=0;this.lock=false;this.viewport=this.elem.parent("div");this.viewportX=this.viewport.offset().left;this.viewportY=this.viewport.offset().top;this.imgWidth=this.elem.width();this.imgHeight=this.elem.height();this.imgRatio=this.imgHeight/this.imgWidth;this.reset();this.viewport.css({position:"relative",overflow:"hidden"});this.elem.removeAttr("alt").removeAttr("title").css({top:0,left:0,position:"relative"}).animate({opacity:1},this.config.animationSpeed).parent().addClass("monocle-loaded");d(".monocle-zoom-in").bind("click",function(h){h.preventDefault();g.zoom("in")});d(".monocle-zoom-out").bind("click",function(h){h.preventDefault();g.zoom("out")});d(".monocle-zoom-fit").bind("click",function(h){h.preventDefault();g.reset()});d(".monocle-move-up, .monocle-move-right, .monocle-move-down, .monocle-move-left").bind("click",function(h){h.preventDefault();g.move(d(this).data("direction"))});if(this.config.keyboard){d(b).keydown(function(h){switch(h.which){case 37:case ((d.browser.opera)?52:100):g.move("left");break;case 38:case ((d.browser.opera)?56:104):g.move("up");break;case 39:case ((d.browser.opera)?54:102):g.move("right");break;case 40:case ((d.browser.opera)?50:98):g.move("down");break;case 107:case 171:case 187:if(d.browser.opera){return}g.zoom("in");break;case 109:case 173:case 189:if(d.browser.opera){return}g.zoom("out");break;case 45:case 48:case 96:g.reset();break;default:return}h.preventDefault()})}if(d.fn.mousewheel){this.elem.bind("mousewheel",function(h,i){h.preventDefault();if(i>0){g.zoom("in")}else{g.zoom("out")}})}this.elem.bind("dblclick",function(h){h.preventDefault();g.zoom("in")});this.elem.on("mousedown",function(h){h.preventDefault();d(this).addClass("monocle-draggable");var l=d(this).offset().left-h.pageX,j=d(this).offset().top-h.pageY,k=0,i=0;d(this).parents().on("mousemove",function(m){m.preventDefault();k=m.pageX+l,i=m.pageY+j;if((g.viewportX-k-(g.curWidth-g.viewWidth))>0){k=g.viewportX-(g.curWidth-g.viewWidth)}if((g.viewportX-k)<0){k=g.viewportX}if((g.viewportY-i-(g.curHeight-g.viewHeight))>0){i=g.viewportY-(g.curHeight-g.viewHeight)}if((g.viewportY-i)<0){i=g.viewportY}d(".monocle-draggable").offset({left:k,top:i})})}).on("mouseup",function(){d(this).removeClass("monocle-draggable")});d(b).on("mouseup",function(){g.elem.removeClass("monocle-draggable")});if(this.config.responsive){var f;d(c).bind("resize",function(){clearTimeout(f);f=setTimeout(function(){g.reset()},100)})}return this},reset:function(){this.viewWidth=d(c).width();this.viewHeight=d(c).height();this.viewport.height(this.viewHeight);this.viewport.width(this.viewWidth);this.curWidth=this.viewWidth;this.curHeight=this.viewWidth*this.imgRatio;if(this.curHeight>d(c).height()){this.curHeight=d(c).height()-this.viewportY*2;this.curWidth=this.curHeight/this.imgRatio}this.zoomStep=(this.imgWidth-this.curWidth)/this.config.maxZoom;this.zoomlevel=0;this.elem.stop(false,true).animate({width:this.curWidth,top:0,left:0},this.config.animationSpeed)},zoom:function(f){var g=0;if(this.lock){return}if(f==="in"&&this.zoomlevel===this.config.maxZoom){return}if(f==="out"&&this.zoomlevel===0){return}switch(f){case"in":this.zoomlevel++;g=-1;break;case"out":this.zoomlevel--;g=1;break}this.curWidth=this.curWidth-this.zoomStep*(g);this.curHeight=this.curHeight-this.zoomStep*(g)*this.imgRatio;this.goTo(g,g,true)},move:function(i){var f=0,h=0,g=this;if(this.lock){return}switch(i){case"up":h=1;break;case"right":f=-1;break;case"down":h=-1;break;case"left":f=1;break}this.lock=true;setTimeout(function(){g.lock=false},this.config.animationSpeed*1.1);this.goTo(f,h,false)},goTo:function(f,g,m){var k=parseFloat(this.elem.css("left")),h=parseFloat(this.elem.css("top")),j=f*parseFloat((this.zoomStep/2)),i=g*parseFloat(((this.zoomStep/2)*this.imgRatio)),l=this.config.animationSpeed;if((this.curWidth-this.viewWidth+(k+j))<0){j=j+Math.abs((this.curWidth-this.viewWidth+(k+j)))}if((k+j)>0){j=Math.abs(k)}if((this.curHeight-this.viewHeight+(h+i))<0){i=i+Math.abs((this.curHeight-this.viewHeight+(h+i)))}if((h+i)>0){i=Math.abs(h)}if(m){l=0}this.elem.stop(false,true).animate({left:"+="+j,top:"+="+i,width:this.curWidth},l)}};a.defaults=a.prototype.defaults;d.fn.monocle=function(f){return this.each(function(){d(this).bind("load",function(){new a(this,f).init()})})}})(jQuery,window,document);